/*
 * Copyright (C) 2013 Motorola Mobility LLC
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */
/* reserve memory for ram_console */
/memreserve/ 0x83000000 0x20000; /* IMAGE_DOWN_LOAD_ADDR */

/include/ "omap36xx.dtsi"

/ {
	model = "Motorola OMAP3 Platform";
	compatible = "mot,omap3-mapphone", "ti,omap3";

	ramoops {
		compatible = "ramoops";
		status = "ok";

		android,ramoops-buffer-start = <0x83000000>;
		android,ramoops-buffer-size  = <0x20000>;
		android,ramoops-console-size = <0x1FC00>;
		android,ramoops-annotate-size = <0x400>;
	};

	cpus {
		cpu@0 {
			device_type = "cpu";
			operating-points = <
				/* kHz    uV */
				 300000   975000
				 600000  1150000
				 800000  1275000
				1000000  1337500
			>;
			/* TODO: cpu0-supply = <&???>; */
			/* OPP tolerance in percentage */
			voltage-tolerance = <0>;
			reset-voltage = <1275000>;
		};
	};

	regulators {
		compatible = "simple-bus";

		vmmc: fixedregulator {
			compatible = "regulator-fixed";
			regulator-name = "vmmc";
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
		};

	};

	/* external 26MHz clock which is controlled by gpio
	 * it's used for both Display Bridge and USB
	 */
	periph_26mhz {
		compatible = "gpio-clock";
		#clock-cells = <0>;
		enable-gpios = <&gpio6 17 0>;  /* GPIO-177, OF_GPIO_ACTIVE_HIGH */
	};

	Display@0 {
		compatible = "mot,minnow-panel-dsi-cm";
		bridge-supply = <&ldo1_reg>;
		panel-supply = <&ldo7_reg>;
		/* 0: MINNOW_PANEL_CM_220X176
		 * 1: MINNOW_PANEL_CM_220X220
		 * 2: MINNOW_PANEL_CM_BRIDGE_320X320
		 */
		id_panel = <2>;
		gpio_panel_reset = <&gpio1 14 0>;       /* RESET gpio-14 */
		gpio_bridge_reset = <&gpio1 23 0>;      /* RESET gpio-23 */
		gpio_vsync_events = <&gpio1 29 0>;      /* VSYNC gpio-29 */
		clk_in = "periph_26mhz";        /* external 26MHz clock */
		/* declare it if ext_te enable */
		//gpio_te = <&gpio1 0 0>;       /* EXT_TE gpio-0 */
		//pins = <0 1 2 3>;             /* DSI Pin config */
		esd_interval = <8000>;          /* ESD_INTERVAL */
		support_smart_ambient;
		ambient_timeout = <0>;		/* time out in second */
		//pixel_clock = <4608>;         /* kHZ = 320*240*60/1000*/
		/* 0: RGB888
		 * 1: RGB666
		 * 2: RGB666_PACKED
		 * 3: RGB565
		 */
		//pixel_format = <1>;
		//hs_clk = <90000000 150000000>;        /* min max*/
		//lp_clk = <7000000 9000000>;   /* min max*/
		//pinctrl-names = "viopulldown", "viooutput";
		//pinctrl-0 = <&display_vddio_pulldown>;
		//pinctrl-1 = <&display_vddio_output>;
	};

	vib-gpio {
		compatible = "mot,vib-gpio";
		gpio = <181>;
		active_low = <0>;
		vib-gpio-supply = <&ldo6_reg>;
	};

	cpcap_phy: cpcap-usb@0 {
		compatible = "mot,cpcap-usb";
	};

	pmic-wdi@0 {
		compatible = "mot,pmic-wdi";
		gpios  = <&gpio5 15 0x0>, /* gpio-143 GPIOF_DIR_OUT|GPIOF_INIT_LOW */
			 <&gpio3 30 0x0>; /* gpio-94  GPIOF_DIR_OUT|GPIOF_INIT_LOW */
		gpio-names = "wdi",
			     "sys_reset";
		//pinctrl-names = "output", "tristate";
		//pinctrl-0 = <&wdi_phy_gpio_mode>;
		//pinctrl-1 = <&wdi_phy_safe_mode>;
	};

	pad-wkup {
		/* on omap, the irqs are calculated as follows:
		 * for the 96 intc IRQs
		 *   irq = 16 + irq_offset (from TRM sec 12.3.2)
		 * for a gpio IRQ (banks numbered 1 to 6
		 *   irq = 16 + 96 + (gpio_bank - 1) * 32
		 */
		compatible = "ti,pad-wkup";

		/* Map the pad offset (off) to an interrupt (IRQ).    */
		/* if handle is 1, an irq will be generated based on  */
		/* the pad wkup bit.  If 0, the pad will be used only */
		/* for reporting, assumingly because the domain will  */
		/* be in a state during suspend to generate the IRQ   */
		/* directly.                                          */
		/* generic_handle_irq() will be called for multiple   */
		/* wakeup sources, but only the first in the order    */
		/* listed below will be reported as the wakeup reason */
		/*                                                    */
		/*             off  IRQ handle                        */
		ti,pad_irq = <0x144  89 1>, /* uart2 - bluetooth      */
		             <0x16e  90 1>, /* uart3 - serial rx      */
		             <0x0a2  96 1>, /* uart4 - m4 rx          */
		             <0x08e 171 1>, /* m4sensor hub           */
		             <0x0e6 211 1>, /* touch                  */
		             <0x140 254 1>, /* USB                    */
		             <0x1a2 288 1>, /* bq5105x charger        */
			     <0x1b0 112 0>, /* gpio0 - tps (dbg only) */
		             <0x5bc 134 1>, /* bq5105x charger pulse  */
		             <0x13c 252 1>; /* battery                */
	};

};

&vc {
	ti,i2c-high-speed;
	ti,i2c-pad-load = <3>;
	vc_mpu{
		ti,master-channel;
	};

	vc_core{
		ti,use-master-slave-addr;
	};
};

&usbhshost {
// Just enable OTG.
};


&glbl_prm {
	status = "ok";
	sys_clk = "osc_sys_ck";
	autoextclkmode = <2>;
	sys_off_mode;
	auto_off;
	auto_retention;
	offmodesetup_time = <3500>;
	clksetup_time = <1000>;
};

&i2c1 {
	clock-frequency = <400000>;
};

&i2c2 {
	clock-frequency = <400000>;
	akm8973 {
		reg = <0x1c>;
		compatible = "mot,akm8973";
		gpio-irq = <175>;
		gpio-reset = <28>;
	};
};

&i2c3 {
	clock-frequency = <400000>;
	lm3554 {
		reg = <0x53>;
		compatible = "mot,lm3554";
		flags = <0x1>;
		torch_brightness_def = <0xa0>;
		flash_brightness_def = <0x30>;
		flash_duration_def = <0x28>;
		config_reg_1_def = <0xe0>;
		config_reg_2_def = <0xf0>;
		vin_monitor_def = <0x00>;
		gpio_reg_def = <0x0>;
	};
};

&mcspi1 {
	clock-frequency = <3000000>;

	cpcap {
		compatible = "mot,cpcap";
		reg = <0>; /* CS 0 */
		spi-max-frequency = <3000000>;
		spi-cs-high;

		irq-gpio = <0>;

		regulators {
			#address-cells = <1>;
			#size-cells = <0>;

			sw1_iva_reg: regulator@0 {
				reg = <0>;
				regulator-compatible = "DCDC1";
				regulator-name = "DCDC1";
				regulator-min-microvolt =  <700000>;
				regulator-max-microvolt = <1487500>;
				regulator-boot-on;
				regulator-always-on;
			};

			sw2_reg: regulator@1 {
				reg = <1>;
				regulator-compatible = "DCDC2";
				regulator-name = "DCDC2";
				regulator-min-microvolt = <3000000>;
				regulator-max-microvolt = <3000000>;
				regulator-boot-on;
				regulator-always-on;
			};

			sw3_reg: regulator@2 {
				reg = <2>;
				regulator-compatible = "DCDC3";
				regulator-name = "DCDC3";
				regulator-min-microvolt = <1875000>;
				regulator-max-microvolt = <1875000>;
				regulator-boot-on;
				regulator-always-on;
			};

			sw4_core_reg: regulator@3 {
				reg = <3>;
				regulator-compatible = "DCDC4";
				regulator-name = "DCDC4";
				regulator-min-microvolt = <500000>;
				regulator-max-microvolt = <1287500>;
				regulator-boot-on;
				regulator-always-on;
			};

			ldo1_reg: regulator@4 {
				reg = <4>;
				regulator-compatible = "LDO1";
				regulator-name = "LDO1";
				regulator-min-microvolt = <1200000>;
				regulator-max-microvolt = <1200000>;
			};

			ldo2_reg: regulator@5 {
				reg = <5>;
				regulator-compatible = "LDO2";
				regulator-name = "LDO2";
				regulator-min-microvolt = <1700000>;
				regulator-max-microvolt = <1700000>;
			};

			ldo3_reg: regulator@6 {
				reg = <6>;
				regulator-compatible = "LDO3";
				regulator-name = "LDO3";
				regulator-min-microvolt = <2950000>;
				regulator-max-microvolt = <2950000>;
			};

			ldo4_reg: regulator@7 {
				reg = <7>;
				regulator-compatible = "LDO4";
				regulator-name = "LDO4";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <1800000>;
			};

			ldo5_reg: regulator@8 {
				reg = <8>;
				regulator-compatible = "LDO5";
				regulator-name = "LDO5";
				regulator-min-microvolt = <2800000>;
				regulator-max-microvolt = <2800000>;
				regulator-always-on;
			};

			ldo6_reg: regulator@9 {
				reg = <9>;
				regulator-compatible = "LDO6";
				regulator-name = "LDO6";
				regulator-min-microvolt = <2400000>;
				regulator-max-microvolt = <2400000>;
			};

			ldo7_reg: regulator@10 {
				reg = <10>;
				regulator-compatible = "LDO7";
				regulator-name = "LDO7";
				regulator-min-microvolt = <2850000>;
				regulator-max-microvolt = <2850000>;
			};

			ldo8_reg: regulator@11 {
				reg = <11>;
				regulator-compatible = "LDO8";
				regulator-name = "LDO8";
				regulator-min-microvolt = <2800000>;
				regulator-max-microvolt = <2800000>;
				regulator-boot-on;
				regulator-always-on;
			};

			ldo9_reg: regulator@12 {
				reg = <12>;
				regulator-compatible = "LDO9";
				regulator-name = "LDO9";
				regulator-min-microvolt = <1200000>;
				regulator-max-microvolt = <1200000>;
			};

			ldo10_reg: regulator@13 {
				reg = <13>;
				regulator-compatible = "LDO10";
				regulator-name = "LDO10";
				regulator-min-microvolt = <2500000>;
				regulator-max-microvolt = <2500000>;
				regulator-always-on;
			};
		};
	};
};


&omap3_pmx_core {
	pinctrl-names = "default";
	pinctrl-0 = <
		&board_pins
		//&audio_gpio_pins
		//&usb_phy_pins
	>;

	board_pins: pinmux_board_pins {
		pinctrl-single,pins = <
			0x0bc 0x004	/* DSS_DATA8, MODE4 | OUTPUT */
			0x0dc 0x004	/* CAM_HS, MODE4 | OUTPUT */
			0x0e4 0x004	/* CAM_FLD, MODE4 | OUTPUT */
			0x0ea 0x10f	/* CAM_D2, GPIO 101, MODE7 | PD */
			0x102 0x00f	/* CAM_STROBE, GPIO 126, MODE7 | PD */
			0x122 0x004	/* SIM_CLK, MODE4 | OUTPUT */
			0x124 0x00f	/* SIM_PWRCTRL, MODE7 | PULLDOWN */
			0x126 0x004	/* SIM_RST, MODE4, GPIO129*/
			0x13e 0x00F	/* MCBSP3_DR, MODE7 | PULLDOWN */
			0x15c 0x10f	/* MCBSP1_CLKR, GPIO 156, MODE7 | PD */
			0x168 0x104	/* MCBSP1_CLKX, MODE4 | INPUT */
			0x198 0x100	/* MCSPI1_CLK, MODE0 | INPUT */
			0x19a 0x000	/* MCSPI1_SIMO, MODE0 | OUTPUT */
			0x19c 0x100	/* MCSPI1_SOMI, MODE0 | INPUT */
			0x19e 0x000	/* MCSPI1_CS0, MODE0 | OUTPUT */
			0x1a0 0x000	/* MCSPI1_CS1, MODE0 | OUTPUT */
			0x1a2 0x4104	/* MCSPI1_CS2, MODE4 | INPUT | OFFWAKEUP */
			0x1a4 0x004	/* MCSPI1_CS3, MODE4 | OUTPUT */
			0x1ae 0x004	/* MCSPI2_CS1, MODE4 | OUTPUT */
			0x5b2 0x000
		>;
	};

	uart2_pins_default: pinmux_uart_pins_default@2 {
		pinctrl-single,pins = <
			0x144 0x4100	/* UART2_CTS, MODE0  | OUTPUT | OFFWAKEUP */
			0x146 0x000	/* UART2_RTS, MODE0 | OUTPUT */
			0x148 0x000	/* UART2_TX, MODE0 | OUTPUT */
			0x14a 0x100	/* UART2_RX, MODE0 | INPUT */
		>;
	};

	uart2_pins_idle: pinmux_uart_pins_idle@2 {
		pinctrl-single,pins = <
			0x144 0x4100	/* UART2_CTS, MODE0  | OUTPUT | OFFWAKEUP */
			0x146 0x004	/* UART2_RTS, MODE4 | OUTPUT */
			0x148 0x000	/* UART2_TX, MODE0 | OUTPUT */
			0x14a 0x100	/* UART2_RX, MODE0 | INPUT */
		>;
	};
};

&omap3_pmx_wkup{
	pinctrl-names = "default";
	pinctrl-0 = <&wkup_pins>;

	wkup_pins: pinmux_wakeup_pins {
	};
};

/* leave gpio bank interface clocks on during suspend
 * to avoid race condition in gpio_irq_handler */
&gpio1 {
	ti,no_idle_on_suspend;
};

&gpio2 {
	ti,no_idle_on_suspend;
};

&gpio3 {
	ti,no_idle_on_suspend;
};

&gpio4 {
	ti,no_idle_on_suspend;
};

&gpio5 {
	ti,no_idle_on_suspend;
};

&gpio6 {
	ti,no_idle_on_suspend;
};

/* external */
&mmc1 {
	status = "okay";
	vmmc-supply = <&vmmc>;
	bus-width = <4>;
};

/* internal */
&mmc2 {
	ti,non-removable;
	bus-width = <8>;
	vmmc-supply = <&ldo5_reg>;
	vmmc_aux-supply = <&sw3_reg>;
};

/* wireless */
&mmc3 {
	ti,non-removable;
	cap-power-off-card;
	bus-width = <4>;
	vmmc-supply = <&vmmc>;
	wl_host_wake_gpio = <65>;
	wifi_pmena = <186>;
};

&usb_otg_hs {
	interface-type = <0>;
	usb-phy = <&cpcap_phy>;
	mode = <3>;
	power = <50>;

};
/* c55 */
&uart1 {
	flags = <0x00200000>;
	open_close_pm;
	autosuspend-delay = <50>; /* ms */
};
/* bluetooth */
&uart2 {
	flags = <0x00200000>;
	ti,no-pm-qos;
	wakeup-capable;
	autosuspend-delay = <100>; /* ms */
	timed-wakelock = <150>; /* ms */
	rx_trig = <32>;

	/* rts_gpio HACK */
	gpios = <&gpio5 17 2>; /* gpio_145 (uart_rts) GPIOF_DIR_OUT|GPIOF_INIT_HIGH */
	pinctrl-names = "default", "idle";
	pinctrl-0 = <&uart2_pins_default>;
	pinctrl-1 = <&uart2_pins_idle>;

	resume-noidle;
};
/* serial console */
&uart3 {
	wakeup-capable;
	autosuspend-delay = <3000>; /* ms */
};

